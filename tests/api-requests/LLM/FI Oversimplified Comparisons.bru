meta {
  name: FI Oversimplified Comparisons
  type: http
  seq: 24
}

post {
  url: {{llmCallerUrl}}/analyze_oversimplified_comparison
  body: json
  auth: bearer
}

headers {
  Content-Type: application/json
}

auth:bearer {
  token: {{vllmApiKey}}
}

body:json {
  {
    "text": "Frank oli kuin härkä posliinikaupassa uudessa työssään, kömpelösti rikkoen protokollan ja luoden kaaosta. Kuten kala kuivalla maalla, hän kamppaili sopeutuakseen yrityskulttuuriin, hänen yhteistyöyrityksensä epäonnistuivat. Hänen johtajansa, käärme heinikossa, näytti salaa sabotoiden hänen ponnistelujaan, myrkyttäen tiimin moraalia hienovaraisilla kritiikeillä. Projekti, tikittävä aikapommi, oli räjähdysreunalla, sen monimutkaiset ongelmat sivuutettiin kiireessä tavoittaa määräaika."
  }
}

tests {
  test("Status should be 200", function () {
    expect(res.getStatus()).to.equal(200);
  });
  
  const expectedPhrases = ["härkä posliinikaupassa", "kala kuivalla maalla", "käärme heinikossa", "tikittävä aikapommi"];
  
  expectedPhrases.forEach(phrase => {
    test(`Phrase '${phrase}' should be detected`, function () {
      const found = res.body.some(item => item.detected_phrase.includes(phrase));
      expect(found).to.be.true;
    });
  });
  
  test("No unexpected phrases should be returned", function () {
    const actualPhrases = res.body.map(item => item.detected_phrase);
    const unexpectedPhrases = actualPhrases.filter(p => !expectedPhrases.some(ep => p.includes(ep)));
    console.log("Unexpected phrases: ", unexpectedPhrases);
    expect(unexpectedPhrases).to.be.empty;
  });
  
  console.log('Body:', res.body);
}

settings {
  encodeUrl: false
}
