meta {
  name: EL Contextual Framing
  type: http
  seq: 18
}

post {
  url: {{llmCallerUrl}}/analyze_contextual_framing
  body: json
  auth: bearer
}

headers {
  Content-Type: application/json
}

auth:bearer {
  token: {{vllmApiKey}}
}

body:json {
  {
    "text": "Δεδομένου του ιστορικού βίας του υπόπτου, η αντιπαράθεση ήταν αναπόφευκτη. Μετά από πολλές ληστείες στην περιοχή, είναι σαφές ότι η γειτονιά γίνεται επικίνδυνη. Στο φως της εθισμού του στα ναρκωτικά, η κατάθεση του κατηγορουμένου δεν μπορεί να εμπιστευτεί. Με τέτοια στερημένη ανατροφή, ο κατηγορούμενος δεν είχε ποτέ την ευκαιρία να γίνει νόμιμος πολίτης. Λαμβάνοντας υπόψη την οικονομική ύφεση, πολλοί άνθρωποι δυσκολεύονται να τα βγάλουν πέρα. Μετά την εξέταση των προηγούμενων αδικημάτων του κατηγορουμένου, αυτό το έγκλημα ταιριάζει στο καθιερωμένο μοτίβο του. Από το ιστορικό ενδοοικογενειακής βίας, μπορούμε να δούμε ότι αυτή η σχέση ήταν τοξική από την αρχή. Κοιτάζοντας τις αντι-κοινωνικές αναρτήσεις του υπόπτου στα μέσα κοινωνικής δικτύωσης, οι βίαιες ενέργειες του ήταν προβλέψιμες. Ως άνεργος απόφοιτος λυκείου, ο ύποπτος ταιριάζει στο προφίλ για αυτό το έγκλημα. Σε μια γειτονιά γνωστή για τη δραστηριότητα συμμοριών, οι μάρτυρες είναι κατανοητά απρόθυμοι να μιλήσουν. Δεδομένου του μεταναστευτικού καθεστώτος του υπόπτου, πολιτιστικές παρεξηγήσεις πιθανότατα οδήγησαν σε αυτή την παραβίαση. Ο καιρός ήταν ηλιόλουστος εκείνη την ημέρα. Ο κατηγορούμενος έφτασε στο δικαστήριο εγκαίρως. Ο δικαστής εξέτασε τα στοιχεία προσεκτικά."
  }
}

tests {
  test("Status should be 200", function () {
    expect(res.getStatus()).to.equal(200);
  });
  
  const expectedSentences = [
    "Δεδομένου του ιστορικού βίας του υπόπτου, η αντιπαράθεση ήταν αναπόφευκτη.",
    "Μετά από πολλές ληστείες στην περιοχή, είναι σαφές ότι η γειτονιά γίνεται επικίνδυνη.",
    "Στο φως της εθισμού του στα ναρκωτικά, η κατάθεση του κατηγορουμένου δεν μπορεί να εμπιστευτεί.",
    "Με τέτοια στερημένη ανατροφή, ο κατηγορούμενος δεν είχε ποτέ την ευκαιρία να γίνει νόμιμος πολίτης.",
    "Λαμβάνοντας υπόψη την οικονομική ύφεση, πολλοί άνθρωποι δυσκολεύονται να τα βγάλουν πέρα.",
    "Μετά την εξέταση των προηγούμενων αδικημάτων του κατηγορουμένου, αυτό το έγκλημα ταιριάζει στο καθιερωμένο μοτίβο του.",
    "Από το ιστορικό ενδοοικογενειακής βίας, μπορούμε να δούμε ότι αυτή η σχέση ήταν τοξική από την αρχή.",
    "Κοιτάζοντας τις αντι-κοινωνικές αναρτήσεις του υπόπτου στα μέσα κοινωνικής δικτύωσης, οι βίαιες ενέργειες του ήταν προβλέψιμες.",
    "Ως άνεργος απόφοιτος λυκείου, ο ύποπτος ταιριάζει στο προφίλ για αυτό το έγκλημα.",
    "Σε μια γειτονιά γνωστή για τη δραστηριότητα συμμοριών, οι μάρτυρες είναι κατανοητά απρόθυμοι να μιλήσουν.",
    "Δεδομένου του μεταναστευτικού καθεστώτος του υπόπτου, πολιτιστικές παρεξηγήσεις πιθανότατα οδήγησαν σε αυτή την παραβίαση."
  ];
  
  expectedSentences.forEach(sentence => {
    test(`Sentence '${sentence}' should be detected`, function () {
      const found = res.body.some(item => item.detected_phrase === sentence);
      expect(found).to.be.true;
    });
  });
  
  test("No unexpected sentences should be returned", function () {
    const actualSentences = res.body.map(item => item.detected_phrase);
    const unexpectedSentences = actualSentences.filter(s => !expectedSentences.includes(s));
    console.log("Unexpected sentences: ", unexpectedSentences);
    expect(unexpectedSentences).to.be.empty;
  });
  
  console.log('Body:', res.body);
}

settings {
  encodeUrl: false
}
