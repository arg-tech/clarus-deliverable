meta {
  name: CS Referential Ambiguity
  type: http
  seq: 7
}

post {
  url: {{llmCallerUrl}}/analyze_referential_ambiguity
  body: json
  auth: bearer
}

headers {
  Content-Type: application/json
}

auth:bearer {
  token: {{vllmApiKey}}
}

body:json {
  {
    "text": "Dívám se ven z okna. Můj přítel je špatný člověk. Ti lidé, se kterými se stýká, jsou špatný vliv. Jen ho táhnou dolů. Jeho máma je moc milá. Všichni vědí, jací jsou. Nemůžeš věřit takovým lidem. Lidé jako oni prostě nedodržují protokol."
  }
}

tests {
  test("Status should be 200", function () {
    expect(res.getStatus()).to.equal(200);
  });
  
  const expectedPhrases = ["Ti lidé", "oni", "takovým lidem", "Lidé jako oni"];
  
  expectedPhrases.forEach(phrase => {
    test(`Phrase '${phrase}' should be detected`, function () {
      const found = res.body.some(item => item.detected_phrase.includes(phrase));
      expect(found).to.be.true;
    });
  });
  
  test("No unexpected phrases should be returned", function () {
    const actualPhrases = res.body.map(item => item.detected_phrase);
    const unexpectedPhrases = actualPhrases.filter(p => !expectedPhrases.some(ep => p.includes(ep)));
    console.log("Unexpected phrases: ", unexpectedPhrases);
    expect(unexpectedPhrases).to.be.empty;
  });
  
  console.log('Body:', res.body);
}

settings {
  encodeUrl: false
}
